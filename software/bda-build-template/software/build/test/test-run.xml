<project name="test-run" default="run" basedir=".">
	<import file="test-common.xml" />
	<!-- -->
	<target name="test:init">
		<var name="svn.changed" unset="true"/>
		<groovy>                                 
			String cmd= "svn status -N .."
			println cmd                              
			process=cmd.execute()                    
			if (process.toString().length() > 0)
			{
			properties["svn.changed"]="true"
			}
		</groovy>                       
		<if>
			<isset property="svn.changed"/>
			<then>
				<echo message="WARNING ${build.dir} has changed files, commit them or changes may be lost because this process changes and reverts files."/>
				<!--
				<fail message="${build.dir} has changed files, commit them or changes may be lost because this process changes and reverts files."/>
				-->
			</then>
		</if>
			
	</target>
	<target name="test:all" depends="test:init">
		<mkdir dir="${antunit.xml.report.dir}"/>
		<antunit failOnError="false" errorproperty="antunit-failure">
			<xmllistener toDir="${antunit.xml.report.dir}" logLevel="info" />
			<plainlistener logLevel="error"/>
			<fileset dir="${basedir}">
				<include name="test-suite*.xml"/>
			</fileset>
		</antunit>
	</target>
	<target name="test:suite:db" depends="test:init">
		<mkdir dir="${antunit.xml.report.dir}"/>
		<antunit failOnError="true">
			<file file="${basedir}/test-suite-db.xml" />
			<xmllistener toDir="${antunit.xml.report.dir}" logLevel="info" />
			<plainlistener logLevel="error"/>
		</antunit>
	</target>

	<target name="report-tests">
		<junitreport>
			<fileset dir="${antunit.xml.report.dir}" includes="*.xml"/>
			<report format="frames" styledir="${antunit-style.dir}"
				todir="${antunit.html.report.dir}"/>
		</junitreport>
		<fail if="antunit-failure">At least one test has failed</fail>
	</target>
	<target name="run" depends="test:all,report-tests">
	</target>
</project>
